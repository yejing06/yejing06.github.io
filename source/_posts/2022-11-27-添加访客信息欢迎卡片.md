---
title: 添加访客信息欢迎卡片
tags:
  - Butterfly
  - Hexo
keywords:
  - 访客信息
  - Butterfly
  - Hexo
  - 美化
categories: 杂谈教程
swiper_index: 6
abbrlink: fc3458a8
date: 2022-11-27 21:53:57
description: 访客信息欢迎卡片
---
# 1、开篇废话
&emsp;&emsp;{% span red, 第一次写这种记录文章 没什么经验 其实还是自己看的啦 也没什么关系！👻 %}
&emsp;&emsp;这次是使用的腾讯的接口获取的IP地址，之前在使用的是搜狐的地址，不过发现搜狐的地址并不是很准确，首先他仅仅可以精确到市级地址，其次就是部分城市返回的json数据仅仅是china，这效果看上去就很像是设置的固定输出语句啦，当天就申请了腾讯的api，但是当时想省事紧紧想把原来嫖的搜狐代码改一下就用啦，结果当然不尽人意了，就一直搁置了，后来见到忘记了是哪位大佬的代码了，身为cv工程师我就，嘿嘿，都懂的，做了一些适当的调整之后就OK啦！
{% span red, **废话说完，那就开始吧**👻 %}
哦 忘记啦 先展示一下效果 这里图片不清楚可以直接去我首页查看！
![](https://s2.loli.net/2022/11/27/H5UYt1FKDlCy9bQ.webp)
# 2、注册腾讯位置服务
## 2.1 注册腾讯位置服务
注册<a href="https://lbs.qq.com/" target="_blank" style="text-decoration:underline;">腾讯位置服务</a>注册就算便啦！
## 2.2 创建应用
&emsp;&emsp;到应用管理-我的应用界面点击`+创建应用`，然后名称类型随便填
![](https://s2.loli.net/2022/11/27/zDQUCEI4u63Nrsy.webp)
&emsp;&emsp;这里的`白名单`填不填都行的，省事就不填。
![](https://s2.loli.net/2022/11/27/hK8tER7nB1JiskP.webp)
## 2.3 获取key值
&emsp;&emsp;完事之后就可以获取自己的`key`了，这个保存好，一会要用！
![](https://s2.loli.net/2022/11/27/RuykiO76xKXzoZg.webp)
# 3、创建js
&emsp;&emsp;在目录Blogroot(博客所在根目录)\source\js下创建`nkt_txmap.js`,插入以下代码。
```js
//get请求
$.ajax({
    type: 'get',
    url: 'https://apis.map.qq.com/ws/location/v1/ip',
    data: {
        key: '`这里填入刚刚获取的key值`',
        output: 'jsonp',
    },
    dataType: 'jsonp',
    success: function (res) {
        ipLoacation = res;
    }
})
function getDistance(e1, n1, e2, n2) {
    const R = 6371
    const { sin, cos, asin, PI, hypot } = Math
    let getPoint = (e, n) => {
        e *= PI / 180
        n *= PI / 180
        return { x: cos(n) * cos(e), y: cos(n) * sin(e), z: sin(n) }
    }

    let a = getPoint(e1, n1)
    let b = getPoint(e2, n2)
    let c = hypot(a.x - b.x, a.y - b.y, a.z - b.z)
    let r = asin(c / 2) * 2 * R
    return Math.round(r);
}

function showWelcome() {
    
    let dist = getDistance(121.506398,31.245384, ipLoacation.result.location.lng, ipLoacation.result.location.lat); //这里换成自己的经纬度
    let pos = ipLoacation.result.ad_info.nation;
    let ip;
    let posdesc;
    //根据国家、省份、城市信息自定义欢迎语
    switch (ipLoacation.result.ad_info.nation) {
        case "日本":
            posdesc = "よろしく，一起去看樱花吗";
            break;
        case "美国":
            posdesc = "Let us live in peace!";
            break;
        case "英国":
            posdesc = "想同你一起夜乘伦敦眼";
            break;
        case "俄罗斯":
            posdesc = "干了这瓶伏特加！";
            break;
        case "法国":
            posdesc = "C'est La Vie";
            break;
        case "德国":
            posdesc = "Die Zeit verging im Fluge.";
            break;
        case "澳大利亚":
            posdesc = "一起去大堡礁吧！";
            break;
        case "加拿大":
            posdesc = "拾起一片枫叶赠予你";
            break;
        case "中国":
            pos = ipLoacation.result.ad_info.province + " " + ipLoacation.result.ad_info.city + " " +ipLoacation.result.ad_info.district;
            ip = ipLoacation.result.ip;
            switch (ipLoacation.result.ad_info.province) {
                case "北京市":
                    posdesc = "北——京——欢迎你~~~";
                    break;
                case "天津市":
                    posdesc = "讲段相声吧。";
                    break;
                case "河北省":
                    posdesc = "山势巍巍成壁垒，天下雄关。铁马金戈由此向，无限江山。";
                    break;
                case "山西省":
                    posdesc = "展开坐具长三尺，已占山河五百余。";
                    break;
                case "内蒙古自治区":
                    posdesc = "天苍苍，野茫茫，风吹草低见牛羊。";
                    break;
                case "辽宁省":
                    posdesc = "我想吃烤鸡架！";
                    break;
                case "吉林省":
                    posdesc = "状元阁就是东北烧烤之王。";
                    break;
                case "黑龙江省":
                    posdesc = "很喜欢哈尔滨大剧院。";
                    break;
                case "上海市":
                    posdesc = "众所周知，中国只有两个城市。";
                    break;
                case "江苏省":
                    switch (ipLoacation.result.ad_info.city) {
                        case "南京市":
                            posdesc = "这是我挺想去的城市啦。";
                            break;
                        case "苏州市":
                            posdesc = "上有天堂，下有苏杭。";
                            break;
                        default:
                            posdesc = "散装是必须要散装的。";
                            break;
                    }
                    break;
                case "浙江省":
                    posdesc = "东风渐绿西湖柳，雁已还人未南归。";
                    break;
                case "河南省":
                    switch (ipLoacation.result.ad_info.city) {
                        case "郑州市":
                            posdesc = "豫州之域，天地之中。";
                            break;
                        case "南阳市":
                            posdesc = "臣本布衣，躬耕于南阳。此南阳非彼南阳！";
                            break;
                        case "驻马店市":
                            posdesc = "峰峰有奇石，石石挟仙气。嵖岈山的花很美哦！";
                            break;
                        case "开封市":
                            posdesc = "刚正不阿包青天。";
                            break;
                        case "洛阳市":
                            posdesc = "洛阳牡丹甲天下。";
                            break;
                        default:
                            posdesc = "可否带我品尝河南烩面啦？";
                            break;
                    }
                    break;
                case "安徽省":
                    posdesc = "蚌埠住了，芜湖起飞。";
                    break;
                case "福建省":
                    posdesc = "井邑白云间，岩城远带山。";
                    break;
                case "江西省":
                    posdesc = "落霞与孤鹜齐飞，秋水共长天一色。";
                    break;
                case "山东省":
                    posdesc = "遥望齐州九点烟，一泓海水杯中泻。";
                    break;
                case "湖北省":
                    posdesc = "来碗热干面！";
                    break;
                case "湖南省":
                    posdesc = "74751，长沙斯塔克。";
                    break;
                case "广东省":
                    posdesc = "老板来两斤福建人。";
                    break;
                case "广西壮族自治区":
                    posdesc = "桂林山水甲天下。";
                    break;
                case "海南省":
                    posdesc = "朝观日出逐白浪，夕看云起收霞光。";
                    break;
                case "四川省":
                    posdesc = "康康川妹子。";
                    break;
                case "贵州省":
                    posdesc = "茅台，学生，再塞200。";
                    break;
                case "云南省":
                    posdesc = "玉龙飞舞云缠绕，万仞冰川直耸天。";
                    break;
                case "西藏自治区":
                    posdesc = "躺在茫茫草原上，仰望蓝天。";
                    break;
                case "陕西省":
                    posdesc = "来份臊子面加馍。";
                    break;
                case "甘肃省":
                    posdesc = "羌笛何须怨杨柳，春风不度玉门关。";
                    break;
                case "青海省":
                    posdesc = "牛肉干和老酸奶都好好吃。";
                    break;
                case "宁夏回族自治区":
                    posdesc = "大漠孤烟直，长河落日圆。";
                    break;
                case "新疆维吾尔自治区":
                    posdesc = "驼铃古道丝绸路，胡马犹闻唐汉风。";
                    break;
                case "台湾省":
                    posdesc = "我在这头，大陆在那头。";
                    break;
                case "香港特别行政区":
                    posdesc = "永定贼有残留地鬼嚎，迎击光非岁玉。";
                    break;
                case "澳门特别行政区":
                    posdesc = "性感荷官，在线发牌。";
                    break;
                default:
                    posdesc = "带我去你的城市逛逛吧！";
                    break;
            }
            break;
        default:
            posdesc = "带我去你的国家逛逛吧。";
            break;
    }

    //根据本地时间切换欢迎语
    let timeChange;
    let date = new Date();
    if (date.getHours()>= 5 && date.getHours() < 11) timeChange = "<span>上午好</span>，一日之计在于晨！";
    else if (date.getHours()>= 11 && date.getHours() < 13) timeChange = "<span>中午好</span>，该摸鱼吃午饭了。";
    else if (date.getHours() >= 13 && date.getHours() < 15) timeChange = "<span>下午好</span>，懒懒地睡个午觉吧！";
    else if (date.getHours() >= 15 && date.getHours() < 16) timeChange = "<span>三点几啦</span>，一起饮茶呀！";
    else if (date.getHours() >= 16 && date.getHours() < 19) timeChange = "<span>夕阳无限好！</span>";
    else if (date.getHours() >= 19 && date.getHours() < 24) timeChange = "<span>晚上好</span>，夜生活嗨起来！";
    else timeChange = "夜深了，早点休息，少熬夜。";


    //自定义文本和需要放的位置
    document.getElementById("welcome-info").innerHTML =
        `&nbsp; &nbsp; &nbsp; &nbsp; 欢迎来自<span>${pos}</span>的小伙伴，${timeChange}<br>&nbsp; &nbsp; &nbsp; &nbsp; 
您距离<span>脑阔疼</span>约有<span>${dist}</span>公里，您的IP为：${ip},${posdesc}`;
}
window.onload = showWelcome;
// 如果使用了pjax在加上下面这行代码
document.addEventListener('pjax:complete', showWelcome);

```
# 4、创建css
&emsp;&emsp;{% span red, 这里我是放在了公告栏里，如果不放公告栏可以不加这个css👻 %}
&emsp;&emsp;在目录Blogroot(博客所在根目录)\source\css下创建`nkt_txmap.css,插入以下代码。`当然也阔以自己写啦！`
```css
.card-announcement {
  background: linear-gradient(to top left, #ffc4f7 0%, #94f3d5 100%) !important;
  color:white;
  line-height:30px;
  font-size:16px;
}

/* 公告栏突出颜色 */
:root {
  --naokuoteng-color: #fffc56;
}

.card-announcement .item-headline span{
  margin-left:0!important;
}

.card-announcement span{
  font-weight:bold;
  font-size:20px!important;
  color:var(--naokuoteng-color);
}
```
# 5、引入js、css和jq
&emsp;&emsp;在_config.butterfly.yml里引入刚刚创建的js、css和JQ
## 5.1 **js和jq**在inject的bottom下引入
```
     #访客信息
     - <script src="/js/jquery-3.6.1.min.js"></script>
     - <script src="/js/nkt_txmap.js"></script>
```
## 5.2 **css**在inject的head下引入
```
- <link href="/css/nkt_txmap.css">
```
## 5.3 下载jq文件
&emsp;&emsp;随便搜索一下就有啦，注意版本号与刚刚引入的一至，如果不一致可更改刚刚引入的jq名字,将其下载到Blogroot(博客所在根目录)\source\js下。
&emsp;&emsp;`补：`<strong>这里补一下我用的jq文件吧</strong>
{% btns rounded grid5 %}
{% cell 下载jq,https://wwzq.lanzoue.com/idr2S0hykqle, fas fa-download %}
{% endbtns %}

# 6、将语句放在要展示的位置
`以公告栏为例  pug文件具有严格缩进，直接删除 + 就好`
`.../themes/butterfly/layout/includes/widget/card_announcement.pug`
```pug
if theme.aside.card_announcement.enable
  .card-widget.card-announcement
    .item-headline
      i.fas.fa-bullhorn.fa-shake
      span= _p('aside.card_announcement')
    .announcement_content!= theme.aside.card_announcement.content
+    #welcome-info
```

&emsp;&emsp;`补：`如果你也用了<strong>公告栏小人</strong>，把其放在如下位置：
```pug
if theme.aside.card_announcement.enable
  .card-widget.card-announcement
    .item-headline
      i.fas.fa-bullhorn.card-announcement-animation
      span= _p('aside.card_announcement')
    .announcement_content!= theme.aside.card_announcement.content
+    #welcome-info
  .xpand(style='height:200px;')
    canvas.illo(width='800' height='800' style='max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;')
script(src='https://fastly.jsdelivr.net/gh/xiaopengand/blogCdn@latest/xzxr/twopeople1.js')
…
```
<p style="font-size:25px;">{% span red, 如此，功至大成！！！👻 %}</p>
![](https://s2.loli.net/2022/11/24/siMAqL1Zewz3QlJ.webp)